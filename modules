import numpy as np
import pandas as pd

class PhotosynthesisSimulator:
    def __init__(self, params):
        self.alpha = params["alpha"]
        self.pmax = params["pmax"]
        self.theta = params["theta"]
        self.o2_factor = params["o2_factor"]

    def generate_light_curve(self, max_light=2000):
        lights = np.linspace(0, max_light, 50)
        rates = self.light_response_function(lights)
        return pd.DataFrame({"light": lights, "rate": rates})

    def light_response_function(self, I):
        # Non-rectangular hyperbola model
        alpha = self.alpha
        pmax = self.pmax
        theta = self.theta

        return (alpha*I + pmax - ((alpha*I + pmax)**2 - 4*alpha*I*pmax*theta)**0.5) / (2*theta)

    def calculate_o2_production(self, I, temp, co2):
        base_rate = self.light_response_function(np.array([I]))[0]
        temp_mod = 1 + 0.03 * (temp - 25)
        co2_mod = 1 + (co2 - 400) / 2000
        o2 = base_rate * temp_mod * co2_mod * self.o2_factor
        return float(o2)
